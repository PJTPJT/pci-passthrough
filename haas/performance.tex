\section{Performance Evaluation}
% Performance evaluation includes the following items.
% - Evaluation testbed and methodology
% - Network bandwidth and latency for the direct NIC assignment
%   - Our CPU optimization
%   - vhost
%   - vfio
%   - NIC bonding of vhost and VFIO
% - DID Efficiency
%   - Delivery effectiveness of NIC interrupts
%   - Delivery effectiveness of local timer interrupts
%   - Time the handling of spurious timer interrupt
% - Service disruption time for the baremetal guest migration
%   - Network downtime
%   - The required time to set up or tear down the VFIO and DTID

\mycomment{
In this section we present our solutions using macro
and micro-benchmarks. We demonstrate the following.
\begin{itemize}
  \item The guest using our optimization matches the baremetal
  network performance with the minimum CPU overhead.
  \item The guest with DTID improves the timer interrupt
  latency by directly handling the timer interrupt and
  updating the timer.
  \item The guest with DTID ignores the NIC-induced timer
  interrupts while achieving the baremetal network bandwidth
  and latency performance with low CPU overhead.
  \item DTID is scalable to all CPUs, while the host has its
  dedicated CPU.
  \item The guest with DTID matches the baremetal CPU
  throughput.
  \item The guest using the bonding driver and our QEMU
  optimization does not experience the apparent network
  downtime during the migration.
  \item The total memory consumption of idle hypervisor is
  between 80 to 120MB of RAM.
\end{itemize}

In addition, the total number lines changed in the guest OS is
387. First, 43 lines of code are added to the timer interrupt
handler to set the PIR timer-interrupt bits and ignore the
spurious timer interrupt. Second, the kernel module of 110
lines is used to adjust for the LAPIC timers. Since the timers
are calibrated by the host at boot time, the guest needs to
adjust its multiplication and shift factor of tick calculation
to the host configuration. The module consumes 16KB of RAM.
Third, the kernel module of 234 lines is used to map or unmap
the shared PID page. The module consumes 16KB of RAM plus $n$
shared PID pages, where each page is 4KB.
}


\subsection{Evaluation Testbed and Methodology}
\input{temp/evaluation_testbed}

\subsection{Network Performance}
\input{temp/cpu_network_io_performance}
% Excel: cpu_network_io_performance.xlsx
% network bandwidth performance: 1 gbps and 40 gbps.
% CPU utilization when guest performs the network I/O.
% number of VM exits during the network I/O.

\subsection{Direct Interrupt Delivery Efficiency}
\input{temp/did_efficiency}
% Excel: did_efficiency.xlsx
% number of interrupts from the network card.
% number of timer interrupts.
% number of spurious interrupts.
% time to handle the spurious interrupts.
% cyclic test and cumulative probability distribution.

\subsection{Seamless Live Migration}
\input{temp/migration_performance}
% Excel: migration_performance.xlsx
% migration downtime
% network downtime
% time to set up and tear down the VFIO NIC.
% time to set up and tear down the DTID.
