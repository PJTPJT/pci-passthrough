In this section we describe the mechanism of migrating a guest with 
direct NIC assignment. The guest is configured with virtio network 
device backed by the vhost driver and a passthrough network interface 
card~\cite{zhai:2008}. For the purpose of simplicity, we assume that the 
guest NIC is the only assigned device. The prototype overcomes 
the challenge of migrating NIC assigned guest by the following
two strategies. First, it uses the Linux bonding driver to
direct the network traffic between the assigned and virtual
NIC. The migration procedure is divided into two parts. During regular operation 
of guest, the assigned NIC is used for higher network bandwidth. 
Before the migration, the host uses the bonding driver and shifts the
network traffic from the assigned NIC to the virtual NIC. It
hot unplugs the assigned NIC and starts the migration. After
the guest resumes at the destination, the destination host hot
plugs the assigned NIC and switches the network traffic
from virtual NIC to assigned NIC. 
%It announces the MAC address of assigned NIC by sending 
%the gracious ARP packets to its local network before 
%shifting the network traffic back to the
%assigned NIC.

% Insert the Guest's network interface configuration.
%
% Seamless VFIO hotplug at the destination. This is
% about the QEMU modification.
% Explain why hotplugging of NIC at the destination cause the
% network downtime?
% Three general steps:
%   - construct a QEMU software object that represent the
%     passthrough NIC. This is done during migration.
%   - realize the QEMU software object. This is done during
%     the migration.
%   - configure the QEMU software object, when the VM wakes
%     up. This is done when the VM wakes up.

Linux provides bonding driver to present multiple network interfaces
into a single logical interface. In \na the virtual NIC and the assigned NIC 
are enslaved in active-backup mode where only one of the interfaces
is active at any time. In active-backup mode, when any of the active
interface fails, one of the slave interfaces becomes active. In \na,
just before the migration is initiated, the network traffic is gradually 
shifted to the slave interface using ARP packets before hot unplugging
the assigned NIC. Once the assigned NIC is hot unplugged, QEMU issues migrate
command. 

